<% if obj.instance_of? Idea %>
  <% idea = obj %>

  <%# SHOW VIEW %>
  <div class="row well idea-well col-md-10 col-md-offset-1"><!-- idea -->
    <%# Core details %>
    <div class="core-details">
      This idea is
      <% if idea.open? %>
        <strong style="color:green;">OPEN</strong>,
        and will close in 
        <%= time_ago_in_words(idea.closing_time) %>.
      <% else %>
        <strong style="color:red;">CLOSED.</strong>
      <% end %>
      <br>
      This idea was created by
      <strong><%= idea.user.full_name %></strong>,
      <%= time_ago_in_words(idea.created_at) %> ago.
      <%= idea.created_at.to_formatted_s(:short) %>
    </div>

    <%# Dropdown menu %>
    <% if idea.user == current_user %>
      <div class="dropdown-chevron dropdown">
        <%# Button %>
        <a class="dropdown-toggle" href="#" id="dropdownMenuLink"
           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fa fa-chevron-down fa-3x" aria-hidden="true"></i>
        </a>
        <%# Contents %>
        <ul class="dropdown-menu dropdown-menu-right">
          <% if idea.open? %>
            <li><%= link_to "Edit Idea", edit_idea_path(idea) %></li>
          <% end %>
          <li>
            <%= link_to "Delete Idea", idea_path(idea), method: :delete,
            data: { confirm: 'Are you sure you want to delete this idea?' } %>
          </li>
        </ul>
      </div>
    <% end %>

    <%# Idea body %>
    <div class="trix-body idea-scroller">
      <%= idea.text.html_safe %>
    </div>

    <%# Idea details %>
    <div class="row idea-details" align="center">
      <small>
        This idea was edited
        <%= time_ago_in_words(idea.updated_at) %> ago.
        <br>
        <% if idea.open? %>
          <% if !idea.real_time_voting? %>
            Voting results will be revealed when the idea closes.
          <% end %>
        <% else %>
          This idea closed
          <%= time_ago_in_words(idea.closing_time) %> ago.
        <% end %>
      </small>
    </div><!-- /idea-details -->

    <!-- Modal Buttons -->
    <div align="center" class="modal-btn-group">
      <% if idea.open? %>
        <button type="button" class="btn btn-primary btn-md" data-toggle="modal"
                data-target="#vote-form">Vote on this idea</button>
      <% end %>
      <% if idea.results_viewable? %>
        <button type="button" class="btn btn-info btn-md" data-toggle="modal"
                data-target="#voting-results">Voting Results</button>
      <% else %>
        <button type="button" class="btn btn-default btn-sm disabled">
          Results currently unavailable
        </button>
      <% end %>
    </div>

    <!-- Modals -->
    <!-- vote-form modal -->
    <div id="vote-form" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
            <h3 align="center" class="modal-title">
              Voting form<br>
              <small>
              Your name and your vote choice
              <strong>will <%= 'not' if !idea.reveal_voter_details? %></strong>
              be displayed.
              </small>
            </h3>
          </div>
          <div class="modal-body">
            <%= render 'votes/form', obj: @idea %>
          </div>
        </div><!-- /content -->
      </div>
    </div><!-- /vote-form modal -->

    <!-- voting-results modal -->
    <div id="voting-results" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
            <h3 align="center" class="modal-title">
              Voting Results
              <% if @idea.open? %>
                <br>
                <small>Results are not final, as voting is still open.</small>
              <% end %>
            </h3>
          </div>
          <div class="modal-body">
            <%= render 'votes/results', obj: @idea %>
          </div>
        </div><!-- /content -->
      </div>
    </div><!-- /voting-results modal -->
    <!-- /modals -->

  </div><!-- /idea -->
<% else %>
  <% obj.each do |idea| %>

    <%# INDEX VIEW %>
    <div class="row well col-md-10 col-md-offset-1">
      <div class="trix-body idea-scroller">
        <%= link_to idea.text.html_safe, idea_path(idea) %>
      </div>
      <p class="idea-details" align="center">
        <small>
          This idea is
          <% if idea.open? %>
            <strong style="color:green;">OPEN</strong>,
            and will close in 
            <%= time_ago_in_words(idea.closing_time) %>.
          <% else %>
            <strong style="color:red;">CLOSED.</strong>
          <% end %>
          <br>
          This idea was created by
          <strong><%= idea.user.full_name %></strong>.
        </small>
      </p>
    </div>
  <% end %>
<% end %>
